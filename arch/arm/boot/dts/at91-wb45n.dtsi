/*
 * at91-wb45n.dts - Device Tree file for wb45n evaluation board
 *
 *  Copyright (C) 2018 Laird
 *
 * Licensed under GPLv2 or later.
 */

#include "at91sam9g25.dtsi"

/ {
	model = "Laird Workgroup Bridge 45N - Atmel AT91SAM (dt)";
	compatible = "laird,wb45n", "laird,wbxx", "atmel,at91sam9x5", "atmel,at91sam9";

	chosen {
		stdout-path = "serial0:115200n8";
	};

	memory {
		reg = <0x20000000 0x4000000>;
	};

	ahb {
		apb {
			pinctrl@fffff400 {
				board {
					pinctrl_usba_vbus: usba_vbus {
						atmel,pins = <AT91_PIOB 11 AT91_PERIPH_GPIO AT91_PINCTRL_DEGLITCH>;		/* PB11 gpio vbus sense, deglitch */
					};
				};
			};
		};
	};
};

&slow_xtal {
	clock-frequency = <32768>;
};

&main_xtal {
	clock-frequency = <12000000>;
};

&slow_osc {
	atmel,osc-bypass;
};

&usart1_clk {
	atmel,clk-output-range = <0 132000000>;
};

&macb0 {
	phy-mode = "rmii";
};

&spi0 {
	cs-gpios = <&pioA 14 0>, <&pioA 7 0>, <0>, <0>;
};

&ebi {
	pinctrl-0 = <&pinctrl_ebi_addr_nand>;
	pinctrl-names = "default";
	status = "okay";
};

&nand_controller {
	pinctrl-0 = <&pinctrl_nand_oe_we
				 &pinctrl_nand_cs
				 &pinctrl_nand_rb>;
	pinctrl-names = "default";
	status = "okay";

	nand: nand@3 {
		reg = <0x3 0x0 0x800000>;
		rb-gpios = <&pioD 5 GPIO_ACTIVE_HIGH>;
		cs-gpios = <&pioD 4 GPIO_ACTIVE_HIGH>;
		nand-bus-width = <8>;
		nand-ecc-mode = "hw";
		atmel,has-pmecc;	/* Enable PMECC */
		atmel,pmecc-cap = <4>;
		atmel,pmecc-sector-size = <512>;
		nand-on-flash-bbt;
		label = "atmel_nand";

		partitions {
			compatible = "fixed-partitions";
			#address-cells = <1>;
			#size-cells = <1>;

			at91bootstrap@0 {
				label = "at91bs";
				reg = <0x0 0x20000>;
			};

			uboot@20000 {
				label = "u-boot";
				reg = <0x20000 0x80000>;
			};

			ubootenv@a0000 {
				label = "u-boot-env";
				reg = <0xa0000 0x20000>;
			};

			ubootenv@c0000 {
				label = "redund-env";
				reg = <0xc0000 0x20000>;
			};

			kernel-a@e0000 {
				label = "kernel-a";
				reg = <0xe0000 0x280000>;
			};

			kernel-b@360000 {
				label = "kernel-b";
				reg = <0x360000 0x280000>;
			};

			rootfs-a@5e0000 {
				label = "rootfs-a";
				reg = <0x5e0000 0x2600000>;
			};

			rootfs-b@2be0000 {
				label = "rootfs-b";
				reg = <0x2be0000 0x2600000>;
			};

			user@51e0000 {
				label = "user";
				reg = <0x51e0000 0x2dc0000>;
			};

			logs@7fa0000 {
				label = "logs";
				reg = <0x7fa0000 0x60000>;
			};
		};
	};
};

&usb0 {
	num-ports = <2>;
	atmel,vbus-gpio = <
			   &pioB 12 GPIO_ACTIVE_HIGH
			   &pioA 31 GPIO_ACTIVE_HIGH
			  >;
	atmel,oc-gpio = <&pioB 13 GPIO_ACTIVE_LOW>;
};